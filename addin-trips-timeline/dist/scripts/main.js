"use strict";geotab.addin.tripsTimeline=function(){function i(t,e){var n,r;n=t,r=e,new Promise(function(t){u.call("Get",{typeName:"Trip",search:{fromDate:n.toISOString(),toDate:r.toISOString()},resultsLimit:1e4},t)}).catch(function(t){return alert(t),[]}).then(function(t){for(var e,n,r,i,a=0;a<t.length;a++)e=t[a],(n=w[e.device.id])&&!p[e.id]&&(p[e.id]=!0,r=new Date(e.start),i=new Date(e.stop),h.push({id:e.id,content:n.name.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")+"<br>"+O(r,i)+y(r,i,n),start:r,end:i}));d.setItems(h),d.redraw()})}function a(t){var e,n;d&&(n=(e=d.getWindow()).end-e.start,d.setWindow({start:e.start.valueOf()+t*n*.5,end:e.end.valueOf()+t*n*.5}))}function o(){s.style.width=s.parentNode.offsetWidth-l.offsetWidth-f.offsetWidth-20+"px"}function r(){return w?(h=[],p={},v=new Date(d.range.start-g),m=new Date(d.range.start+g),o(),i(v,m),!0):(t(),!(D=!0))}function n(t){var e=""+t.getHours(),t=""+t.getMinutes();return(e=1===e.length?"0"+e:e)+":"+(t=1===t.length?"0"+t:t)}var u,c,d,s=document.getElementById("tripstimeline-chart-container"),l=document.getElementById("tripstimeline-chart-prev"),f=document.getElementById("tripstimeline-chart-next"),v=new Date,m=new Date,g=144e5,h=[],p={},w=!1,D=!1,I=null,t=function(){return u.call("Get",{typeName:"Device",resultsLimit:1e3,search:{groups:c.getGroupFilter?c.getGroupFilter():[{id:"GroupCompanyId"}],fromDate:(new Date).toISOString}},function(t){for(var e={},n=0;n<t.length;n++)e[t[n].id]=t[n];w=e,D&&(r(),D=!1)},function(t){alert(t)}),!1},O=function(t,e){return n(t)+" - "+n(e)},y=function(t,e,n){return"<a href=\"#tripsHistory,dateRange:(endDate:'' + end.toISOString() + '',startDate:'' + start.toISOString() + ''),devices:!(".concat(n.id,')" class="geotabButtonIcons externalLink detailslink" target="_blank"></a>')};return{initialize:function(t,e,n){u=t,c=e,function(){(d=new vis.Timeline(s,[],{orientation:"top",zoomMin:144e5,zoomMax:144e5,minHeight:180})).on("rangechange",function(t){var e;t.start.valueOf()-v.valueOf()<72e5&&(e=v,v=new Date(v.valueOf()-g),i(v,e)),m.valueOf()-t.end.valueOf()<72e5&&(e=m,m=new Date(m.valueOf()+g),i(v,e))});function t(){I||(a(-1),I=window.setInterval(function(){a(-1)},200))}function e(){I||(a(1),I=window.setInterval(function(){a(1)},200))}function n(){I&&(window.clearInterval(I),I=null)}var r=function(){var e=!0;try{document.createEvent("TouchEvent")}catch(t){e=!1}return e}();r?l.addEventListener("touchstart",t,!1):l.addEventListener("mousedown",t,!1),r?f.addEventListener("touchstart",e,!1):f.addEventListener("mousedown",e,!1),document.body.addEventListener("mouseup",n,!1),r&&document.body.addEventListener("touchend",n,!1),o()}(),n&&n()},focus:function(t,e){u=t,c=e,w=!1,r()},blur:function(){h=[],w=!(p={})}}};