"use strict";var angularObj={app:null,initAngular:function(){var r=document.getElementById("importKmlZones");angularObj.app=angular.module("importKMLZones",[]),angularObj.app.directive("modalDialog",function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,n){e.dialogStyle={},n.width&&(e.dialogStyle.width=n.width),n.height&&(e.dialogStyle.height=n.height),e.hideModal=function(){e.show=!1,r.style.overflow="",r.style.height="auto"}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}),angularObj.app.service("clearService",function(){var e={clear:function(){kml.clear()}};return e}),angularObj.app.controller("optionsController",["$scope","clearService",function(n,e){n.modalShown=!1,n.toggleModal=function(){function t(e){n.zoneTypeOptions=[],kml.prevSelectedTypes=[],e.forEach(function(e){n.zoneTypeOptions.push({id:e.id,name:e.name,isSystem:e.isSystem||!1,comment:e.comment||""})}),n.$apply(),kml.options.zoneTypes.every(function(e,t){var n=r.querySelector("#typesSelect");return e!==kml.defaultZoneType||-1!==n.selectedIndex||(n.selectedIndex=t,!1)})}kml.api.call("Get",{typeName:"ZoneType"},function(e){t(kml.addSystemZoneTypes(e,!0))},function(){t(kml.addSystemZoneTypes([],!0))}),n.colorPickerValue=kml.colorPicker.getPicker().getHexValue(),n.transparencySliderValue=n.transparencySliderValue||kml.colorPicker.getDefaultTransparencyValue(),kml.utils.inputTypeSupport("range","a")&&(r.querySelector(".vanillaSlider").value=n.transparencySliderValue),angular.element(r.querySelector("input.vanillaSlider")).on("input",function(e){e=e.target.value;n.transparencySliderValue=Number(e),kml.colorPicker.getTransparencyControl().set({a:e}),r.querySelector("#colorPickerField").style.opacity=(100-e)/100,n.$apply()});var e=r.querySelector("#colorPickerField");kml.utils.inputTypeSupport("color","hello world")?angular.element(e).on("change",function(){kml.colorPicker.getPicker().setValue(kml.utils.hexToRGBArray(this.value))}):(angular.element(e).on("focus",function(){kml.colorPicker.getPicker().originalPicker.showPicker(this)}),angular.element(e).on("blur",function(){var e=kml.colorPicker.getPicker().originalPicker.valueElement.value;!1===kml.colorPicker.getPicker().originalPicker.pickerIsActive?kml.colorPicker.getPicker().originalPicker.hidePicker():(n.colorPickerValue=e,this.value=e,this.style.backgroundColor=e,n.$apply(),this.focus())})),n.modalShown=!n.modalShown,!0===n.modalShown&&(r.style.overflow="hidden",r.style.height="100%")},n.setQuickColor=function(e){n.colorPickerValue=kml.colorPicker.setQuickColor(e)},n.changeZoneStop=function(e){e.target.checked||e.preventDefault();for(var t=e.target.parentNode.querySelectorAll(".geotabSwitchButton"),n=0;n<t.length;n++)t[n].id!==e.target.id&&(t[n].checked=!1);e.target.checked=!0},n.applyOptions=function(){kml.applyOptions(),r.style.overflow="",r.style.height="auto",n.modalShown=!1},n.setDefaultOptions=function(){kml.setDefaultOptions(),n.colorPickerValue=kml.colorPicker.getDefaultColorHex(),n.transparencySliderValue=kml.colorPicker.getDefaultTransparencyValue(),kml.utils.inputTypeSupport("range","a")&&(r.querySelector(".vanillaSlider").value=n.transparencySliderValue)},n.clear=function(){e.clear()},n.selectType=function(e){var t,n=null,o=r.querySelector("#typesSelect");for(kml.prevSelectedTypes=kml.prevSelectedTypes||[],setTimeout(function(){for(t=0;t<kml.prevSelectedTypes.length;t++)o.options[kml.prevSelectedTypes[t]].selected=!0;null!==n&&(o.options[n].selected=!1)},0),kml.selectedTypes=o.selectedOptions||kml.utils.getSelectValues(o),t=0;t<kml.selectedTypes.length;t++)-1===kml.prevSelectedTypes.indexOf(kml.selectedTypes[t].index)&&kml.prevSelectedTypes.push(kml.selectedTypes[t].index);e.target.selected?(n=e.target.index,kml.prevSelectedTypes.splice(kml.prevSelectedTypes.indexOf(n),1)):n=null}}]),angularObj.app.controller("parsedDataController",["$scope","clearService",function(e,t){e.uploaderTitle=kml.isFormDataSupported?"Drop your files here or click to select them":"Click here to choose kml file",e.importSelectedZones=function(){kml.importZones()},e.hideImported=function(e){kml.hideImported(e)},e.exportKML=function(){kml.exportKML()},e.selectAll=function(e){kml.selectAll(e)},e.uploadFiles=function(e){e=e.target.files;t.clear(),kml.parseFiles(e)}}])}};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={api:null,state:null,args:{},item:null,childCallback:{},minDate:new Date(Date.UTC(1986,0,1)),defaultZoneSize:200,localInit:["addressLookup","Address Lookup","customer","Customer","office","Office","home","Home"],isFormDataSupported:!!window.FormData,fileReader:null,filter:null,colorPickerObj:null,zoneCreator:null,options:{},zonesData:{zones:[],commonStyles:[]},uploader:null,utils:null,colorPicker:null,vanillaSlider:null,waiting:null,importedInBG:[],itemsPerCall:50,defaultZoneType:"ZoneTypeCustomerId",initVariables:function(e,t){var n=this;this.api=e,this.state=t,this.args.container=document.getElementById("importKmlZones"),this.local=this.setupLocal(this.localInit),this.filter=t.getGroupFilter(),this.utils=new Utils,this.fileReader="undefined"!=typeof FileReader?new FileReader:null,this.uploader=new Uploader,this.vanillaSlider=new VanillaSlider,this.waiting=new Waiting,Array.prototype.forEach.call(this.args.container.parentNode.getElementsByClassName("extern"),function(e){e.id&&(n.args[e.id]=e)}),this.colorPicker=new ColorPicker,this.colorPickerObj=this.colorPicker.formColorPicker(),this.zoneCreator=this.zoneShapeCreator(),this.options={zoneTypes:[this.defaultZoneType],zoneSize:this.defaultZoneSize,zoneColor:this.colorPickerObj.value(),zoneShape:!1,stoppedInsideZones:this.args.container.querySelector("#stoppedInsideZones").checked}},NOOP:function(){},setupLocal:function(e){var t,n,o={};if(e.length%2!=0)throw new Error("incorrect data items");for(t=0;t<e.length;t+=2){if(o[n=e[t]])throw new Error(n+" already added");o[n]=e[t+1]}return o},addSystemZoneTypes:function(e,t){for(var n,o,r={ZoneTypeAddressLookupId:this.local.addressLookup,ZoneTypeCustomerId:this.local.customer,ZoneTypeOfficeId:this.local.office,ZoneTypeHomeId:this.local.home},l=!1,i=0,a=e.length;i<a;i+=1)n=(o=e[i]).id||o,o.id||(t&&"ZoneTypeAddressLookupId"===n?(e.splice(i,1),--i,--a):e[i]={id:o,name:r[n],isSystem:l=!0});if(!l)for(var s in r)!r.hasOwnProperty(s)||t&&"ZoneTypeAddressLookupId"===s||e.push({id:s,name:r[s],comment:this.localInit.systemAssignedComment,isSystem:!0});return e},zoneShapeCreator:function(){return{getZonePoints:function(e,t,n,o){n=n?360*n/40075e3:.0018;return(o?function(e,t,n){for(var o,r,l=n/2,n=l-8e-5/n*n,n=2*Math.sqrt(l*l-n*n),n=Math.ceil(Math.PI/Math.asin(n/(2*l))),i=n<20?20:n+1,a=2*Math.PI/(i-1),s=0,c=[],u=0;u<i;u++)r=e+l*Math.cos(s),o=t+l*Math.sin(s)/Math.abs(Math.cos(r*Math.PI/180)),c.push({x:o,y:r}),s+=a;return c}:function(e,t,n){for(var o=n/2||9e-4,r=[[1,1],[-1,1],[-1,-1],[1,-1]],l=[],i=0;i<r.length;i++)l.push({x:t+r[i][0]*o,y:e+r[i][1]*o/1.5});return l})(e,t,n)}}},parseFiles:function(r){var l=this,i=r.length,a=0;0!==i&&(this.waiting.show(),this.fileReader.onload=function(e){var t,n,o,e=e.target.result,e=(new DOMParser).parseFromString(e,"text/xml");if(l.isFileDataValid(e,r[a].name)){for(t=e.documentElement.querySelectorAll("Placemark"),n=e.documentElement.querySelectorAll("Style"),o=0;o<t.length;o++)l.zonesData.zones.push(t[o]);for(o=0;o<n.length;o++)n[o].id&&(l.zonesData.commonStyles[n[o].id]=n[o])}++a<i?l.fileReader.readAsText(r[a]):a===i&&l.populateZoneTables(),l.waiting.hide()},this.fileReader.readAsText(r[0]))},isFileDataValid:function(e,t){var n=e.documentElement.querySelector("Placemark");return"kml"===e.documentElement.tagName.toLowerCase()&&n?0===n.getElementsByTagName("name").length?(this.utils.showError("Name field required in "+t+"."),!1):!(!this.isPoint(n)&&!this.isPolygon(n))||(this.utils.showError(t+" must content a point or polygon data."),!1):(this.utils.showError("File '"+t+"' content format is incorrect."),!1)},populateZoneTables:function(){function a(e){function t(e,t,n){return!!(!isNaN(e)&&t<=e&&e<=n)}var n,o={valid:!0,message:""};for(0===e.name.length&&(o.valid=!1,o.message+="Zone name can not be empty. "),0===e.points.length&&(o.valid=!1,o.message+="Zone coordinates can not be empty. "),n=0;n<e.points.length;n++)t(e.points[n].y,-90,90)||(o.valid=!1,o.message+="Latitude coordinate value = "+e.points[n].y+" is incorrect. "),t(e.points[n].x,-180,180)||(o.valid=!1,o.message+="Longitude coordinate value = "+e.points[n].x+" is incorrect. ");return o}var s=this,c=!1;this.zonesData.zones.forEach(function(e,t){e.zoneParameters=s.getZoneParameters(e);var n,o,r,l=e.zoneParameters.isPolygon?s.args.container.querySelector("#polygonList table"):s.args.container.querySelector("#pointList table"),i=a(e.zoneParameters);"none"===l.parentNode.style.display&&(l.parentNode.style.display=""),(n=document.createElement("tr")).id="row"+t,o=document.createElement("td"),l.querySelector("tbody").appendChild(n),n.appendChild(o),o.textContent=e.zoneParameters.name,(o=o.cloneNode()).textContent=e.zoneParameters.comment||"-",n.appendChild(o),o=o.cloneNode(),e.zoneParameters.colorFromOptions?o.textContent="Set by options.":((r=document.createElement("div")).className="colorDiv",r.style.backgroundColor=s.utils.rgbToHex.apply(s.utils,s.utils.colorObjToArr(e.zoneParameters.fillColor)),r.style.opacity=e.zoneParameters.fillColor.a/255,o.appendChild(r)),n.appendChild(o),o=o.cloneNode(),!0===i.valid?(c=!0,(r=document.createElement("input")).type="checkbox",r.id=t,r.className="importCheckbox",r.checked=!0,o.appendChild(r)):(n.className="error",s.args.container.querySelector("#exportKML").style.display="",o.textContent=i.message),n.appendChild(o)}),!0===c&&(this.args.container.querySelector("#importButton").style.display="",this.args.container.querySelector("#selectAll").checked=!0,this.args.container.querySelector("#selectAllLabel").style.display="")},isPoint:function(e){e=e.getElementsByTagName("Point");return 0<e.length&&0<e[0].getElementsByTagName("coordinates").length},isPolygon:function(e){var t=e.getElementsByTagName("Polygon"),n=0<t.length?t[0].getElementsByTagName("outerBoundaryIs"):[],e=0<n.length?n[0].getElementsByTagName("LinearRing"):[];return 0<t.length&&0<n.length&&0<e.length&&0<e[0].getElementsByTagName("coordinates").length},getZoneParameters:function(e){var t,n=e.getElementsByTagName("description"),o=0<e.getElementsByTagName("Style").length?e.getElementsByTagName("Style")[0]:null,r=0<e.getElementsByTagName("styleUrl").length?e.getElementsByTagName("styleUrl")[0].textContent.replace("#",""):null,l=r?this.zonesData.commonStyles[r]:null,r=o||l,o=!0;return!r||(l=(r=(l=r.getElementsByTagName("PolyStyle"))&&0<l.length?l[0].querySelector("color"):null)?r.textContent.replace("#","").trim():null)&&(r=l.slice(-2)+l.slice(4,6)+l.slice(2,4),t=l.slice(0,2),o=!(t={r:(r=this.utils.hexToRGBArray(r))[0],g:r[1],b:r[2],a:parseInt(t,16)})),{activeFrom:this.minDate,activeTo:new Date(2050,0,1),comment:0<n.length?this.utils.decodeHTMLEntities(n[0].textContent):"",displayed:!0,externalReference:"",fillColor:o?this.options.zoneColor:t,colorFromOptions:o,groups:this.filter,name:this.utils.decodeHTMLEntities(e.getElementsByTagName("name")[0].textContent.trim()),points:this.getPoints(e),zoneTypes:this.options.zoneTypes,zoneSize:this.options.zoneSize,zoneShape:this.options.zoneShape,mustIdentifyStops:this.options.stoppedInsideZones,isPolygon:this.isPolygon(e),isPoint:this.isPoint(e)}},getPoints:function(e){function r(e,t,n,o){function r(e){return e*(Math.PI/180)}var l=r(n-e),t=r(o-t),t=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r(e))*Math.cos(r(n))*Math.sin(t/2)*Math.sin(t/2);return 6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))}var t,n,l,i,a,s,o,c="",u=[];return this.isPoint(e)?(c=e.querySelector("coordinates").textContent,u=this.zoneCreator.getZonePoints(+c.split(",")[1],+c.split(",")[0],this.options.zoneSize,this.options.zoneShape)):this.isPolygon(e)&&(t=(o=e.getElementsByTagName("Polygon")[0]).getElementsByTagName("outerBoundaryIs"),n=o.getElementsByTagName("innerBoundaryIs"),0<t.length&&0<n.length?(e=t[0].querySelector("coordinates"),o=n[0].querySelector("coordinates"),e=e.textContent.trim().split(/\s/),l=o.textContent.trim().split(/\s/),i=null,s=a=0,o=function(e,t,n){for(var o=e;o<t;o++)0<n[o].length&&u.push({x:n[o].split(",")[0],y:n[o].split(",")[1]})},e.forEach(function(n,o){0<n.length&&(n=n.split(","),l.forEach(function(e,t){0<e.length&&(e=e.split(","),null===i?i=r(n[0],n[1],e[0],e[1]):i>r(n[0],n[1],e[0],e[1])&&(i=r(n[0],n[1],e[0],e[1]),a=o,s=t))}))}),o(0,a+1,e),o(s,l.length,l),o(1,s+1,l),o(a,e.length,e)):0<t.length&&0===n.length&&(c=t[0].querySelector("coordinates")).textContent.trim().split(/\s/).forEach(function(e){0<e.length&&u.push({x:e.split(",")[0],y:e.split(",")[1]})})),u},markRowSuccess:function(e,t){var n=document.getElementById("row"+e),o=document.createElement("a"),r=document.createElement("button"),e=document.createElement("span");n.className="imported",n.lastChild.textContent="Zone successfully imported.",e.className="geotabButtonIcons iconSearch",r.appendChild(e),r.style.float="right",r.className="geotabButton emptyButton",o.appendChild(r),o.href="#map,zones:!((id:"+t+"))",n.firstChild.appendChild(o)},markRowError:function(e,t){e=document.getElementById("row"+e);e.className="error",e.lastChild.textContent=t},updateControlsVisibility:function(e){if(!this.args.container)return!1;var t=this.args.container.querySelectorAll(".imported"),n=this.args.container.querySelectorAll(".error");0<t.length&&(this.args.container.querySelector("#hideImportedLabel").style.display=""),0<n.length&&(this.args.container.querySelector("#exportKML").style.display=""),e&&this.args.container.querySelector("#importButton").removeAttribute("disabled"),0===this.args.container.getElementsByClassName("importCheckbox").length&&(this.args.container.querySelector("#selectAllLabel").style.display="none")},saveZones:function(t){function o(e){a++,r.waiting.updateProgressBar(100*e/t.length),a===l.length?(r.waiting.hideProgressBar(),(e=r.args.container.querySelector("#importButton"))&&e.removeAttribute("disabled")):s(l[a]),r.updateControlsVisibility()}var r=this,n=[],l=[],i=0,a=0,s=function(e){r.api.multiCall(e,function(n){e.every(function(e,t){t="string"==typeof n?n:n[t];return r.args.container?r.markRowSuccess(e[1].entity.rowId,t):r.importedInBG.push({rowId:e[1].entity.rowId,id:t}),!0}),o(e.length)},function(t){e.every(function(e){return r.args.container?r.markRowError(e[1].entity.rowId,t):r.importedInBG.push({rowId:e[1].entity.rowId,message:t}),!0}),o(e.length)})};0!==t.length?(t.every(function(e){return i<r.itemsPerCall?i++:(l.push(n),n=[],i=1),n.push(["Add",{typeName:"Zone",entity:e}]),!0}),0<n.length&&l.push(n),this.args.container.querySelector("#importButton").setAttribute("disabled","disabled"),this.waiting.showProgressBar(),s(l[0])):alert("No selected zones to import.")},updateImportedInBG:function(){var t=this;this.importedInBG.every(function(e){return void 0!==e.id?t.markRowSuccess(e.rowId,e.id):void 0!==e.message&&t.markRowError(e.rowId,e.message),!0}),this.updateControlsVisibility(!0),this.importedInBG=[]},importZones:function(){for(var e=this.args.container.getElementsByClassName("importCheckbox"),t=[],n=0;n<e.length;n++)e[n].checked&&(t.push(this.zonesData.zones[e[n].id].zoneParameters),t[t.length-1].rowId=e[n].id);this.saveZones(t)},hideImported:function(e){var t,n=this.args.container.getElementsByClassName("imported");if(!0===e.currentTarget.checked)for(t=0;t<n.length;t++)n[t].style.display="none";else for(t=0;t<n.length;t++)n[t].style.display=""},exportKML:function(){for(var e,o=this,t=this.args.container.querySelectorAll(".checkmateListTable .error"),r="",n=("download"in document.createElement("a")),l=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=0;i<t.length;i++){var a=this.zonesData.zones[t[i].id.replace("row","")];r+=(new XMLSerializer).serializeToString(a)}r='<?xml version="1.0" encoding="UTF-8"?>\n<kml>'+r+"</kml>",navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs,l&&(window.saveAs||navigator.saveBlob)?e=function(e,t){var n=new l;n.append(e),n=n.getBlob("text/plain; charset=UTF-8"),window.saveAs?window.saveAs(n,t):navigator.saveBlob(n,t)}:n&&(e=function(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r)),n.setAttribute("download",t),n.style.display="none",o.args.container.appendChild(n),n.click(),o.args.container.removeChild(n)}),e?e(r,"not_imported.kml"):alert("Your browser does not support any method of saving JavaScript gnerated data to files.")},selectAll:function(e){for(var t=document.getElementsByClassName("importCheckbox"),n=0;n<t.length;n++)t[n].checked=!!e.currentTarget.checked},clearDataTables:function(){function e(e){var t=(e=o.args.container.querySelector("#"+e+" table")).querySelectorAll("tr");if(2<t.length)for(var n=2;n<t.length;n++)t[n].parentNode.removeChild(t[n]);"none"!==e.parentNode.style.display&&(e.parentNode.style.display="none",o.args.container.querySelector("#importButton").style.display="none",o.args.container.querySelector("#hideImportedLabel").style.display="none",o.args.container.querySelector("#progressContainer").style.display="none",o.args.container.querySelector("#exportKML").style.display="none")}var o=this;e("polygonList"),e("pointList"),this.args.container.querySelector("#selectAll").checked=!1,this.args.container.querySelector("#selectAllLabel").style.display="none",this.utils.hideError()},applyOptions:function(){for(var t=this,n=this.args.container.querySelector("#typesSelect").selectedOptions||this.utils.getSelectValues(this.args.container.querySelector("#typesSelect")),o=[],e=this.args.container.querySelector("#optionsControllerElement"),r=angular.element(e).scope().zoneTypeOptions,l=0;l<n.length;l++)r.every(function(e){return e.id!==n[l].value||(o.push(!0===e.isSystem?e.id:e),!1)});this.options.zoneTypes=o,this.options.zoneColor=this.colorPickerObj.value(),this.options.transparencyValue=this.colorPicker.getTransparencyControl().get(),this.options.stoppedInsideZones=this.args.container.querySelector("#stoppedInsideZones").checked,this.zonesData.zones.forEach(function(e){e.zoneParameters=t.getZoneParameters(e)})},setDefaultOptions:function(){for(var e=this.args.container.querySelector("#typesSelect"),t=this.args.container.querySelector("#colorPickerField"),n=0;n<e.options.length;n++)e.options[n].selected=e.options[n].value===this.defaultZoneType;this.colorPicker.setDefaultColor(),t.value=this.colorPicker.getDefaultColorHex(),t.style.opacity=this.colorPicker.getDefaultColor()[3]/255,this.args.container.querySelector("#stoppedInsideZonesNo").checked=!1,this.args.container.querySelector("#stoppedInsideZones").checked=!0},clear:function(){this.uploader.clear(),this.zonesData.zones=[],this.zonesData.commonStyles=[],this.clearDataTables()}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.kml=e}(),function(){function e(){var c,i={path:!0,circle:!0,svg:!0,rect:!0,text:!0};return{vanilla:c={addClasses:function(e,t){for(var n,o,r=t.split(" "),l=0;l<r.length;l++)n=e,o=r[l],n.classList?n.classList.add(o):(n=a(n)).get().indexOf(o)<0&&n.set(n.get()+(n.get()?" ":"")+o)},hasClass:function(e,t){return-1!==a(e).get().indexOf(t)},css:function(e,t){var n,o;Object.keys(t).forEach((n=e,o=t,function(e){n.style[e]=o[e]}))},create:function(n,e,t){var o,r,l,o=(o=(n||"").toUpperCase(),i.hasOwnProperty(o.toLowerCase())?document.createElementNS("http://www.w3.org/2000/svg",o):document.createElement(o));return e&&Object.keys(e).forEach((r=o,l=e,function(t){try{r.setAttribute(t,l[t])}catch(e){throw new Error("Try to set "+t+" attribute "+l[t]+" to "+r.tagName+" ("+n+"). Connected with this error: "+e.message)}})),t&&c.css(o,t),o},extend:function(){var e,t,n,o,r,l=arguments.length,i=!1,a=arguments[0],s=1;for("boolean"==typeof a&&(i=a,a=arguments[1],s++);s!==l;){for(e=arguments[s],t=Object.keys(e),r=0;r<t.length;r++)n=e[t[r]],i&&(d(n)||u(n))?(o=a[t[r]],o=a[t[r]]=d(o)||u(o)?o:u(n)?[]:{},c.extend(i,o,n)):a[t[r]]=e[t[r]];s++}return a},isArray:u,show:function(e){var t,n,o=document.body;return"none"!==l(e)||(r(e,""),"none"===l(e)&&(n=e.nodeName,t=document.createElement(n),o.appendChild(t),"none"===(n=l(t))&&(n="block"),o.removeChild(t),r(e,n))),e},hide:function(e){return r(e,"none")},toggle:function(e,t){t?this.show(e):this.hide(e)},closest:function(e,t){var n=e&&(e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector);if(n)for(;e&&e!==document.body;){if(n.bind(e)(t))return e;e=e.parentNode}return!1},offset:function(e){var t,n=0,o=0,r={left:0,top:0};if(null!==e){for(t=e;null!==t;)n+=t.offsetLeft,o+=t.offsetTop,t=t.offsetParent;r.left=n,r.top=o}return r}},slider:function(e,n){var t={max:100,min:0,step:5,value:0},T=window.document.body,P=kml.utils.isBrowserSupportTouchEvents(),E=n?Object.keys(n).reduce(function(e,t){return e[t]=n[t],e},t):t,o=(kml.utils.inputTypeSupport("range","a")?function(e){var n=e.appendChild(kml.vanillaSlider.vanilla.create("INPUT",{class:"vanillaSlider",type:"range",max:E.max,min:E.min,step:E.step,value:E.value,"ng-model":"sliderValue"})),t=kml.utils.NOOP;return kml.slider=n,"function"==typeof E.onChange&&(t=E.onChange,n.addEventListener("change",function(e){t.call(this,this.value,e)},!1),n.addEventListener("input",function(e){t.call(this,this.value,e)},!1)),{set:function(e,t){n[e]=t},get:function(e){return n[e]},disable:function(){n.setAttribute("disabled","disabled")},enable:function(){n.removeAttribute("disabled")}}}:function(n){function o(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}function r(e,t){var n=k&&Math.round(Math.abs(e)/k)*g,t="number"==typeof t?t:p;return n&&(m=e<0?Math.max(f,t-n):Math.min(h,t+n),m=Math.round(m/g)*g,S(m),s.call(c,m)),m}function e(e){r(e.pageX-w)}function t(e){var t;e.target!==c&&(t=this.getBoundingClientRect(),k=t.width/v,p=r(e.pageX-t.left,0))}function l(e){var t;if("changedTouches"in e){if(1!==e.changedTouches.length)return!0;t=e.changedTouches[0]}else t=e;return C[e.type].call(this,t,e)}function i(){p=m,c.dispatchEvent(o("blur")),T.removeEventListener(b.move,l,!1),T.removeEventListener(b.end,l,!1)}function a(e,t){t.preventDefault(),w=e.pageX,d=n.offsetWidth,k=d/v,u=c.offsetWidth/2,c.dispatchEvent(o("focus")),T.addEventListener(b.move,l,!1),T.addEventListener(b.end,l,!1)}var s=kml.utils.NOOP,c=n.appendChild(kml.vanillaSlider.vanilla.create("SPAN",{class:"vanillaSliderElement"})),u=c.offsetWidth/2,d=n.offsetWidth,p=0,m=0,h=E.max,f=E.min,g=E.step,y=h-f,v=y/g,k=d/v,S=function(e){c.style.left=(e-f)/y*100+"%"},b={start:P?"touchstart":"mousedown",move:P?"touchmove":"mousemove",end:P?"touchend":"mouseup"},w=0,C={mousedown:a,touchstart:a,mousemove:e,touchmove:e,mouseup:i,touchend:i};return kml.vanillaSlider.vanilla.addClasses(n,"vanillaSlider"),c.addEventListener(b.start,l,!1),n.addEventListener("click",t,!1),c.style.left=-u+"px","function"==typeof E.onChange&&(s=E.onChange),E.value&&(p=Math.max(Math.min(E.value,h),f),S(p)),{set:function(e,t){p=Math.max(Math.min(t,h),f),S(p),s.call(c,p)},get:function(){return p},disable:function(){c.removeEventListener(b.start,l,!1),n.removeEventListener("click",t,!1),i()},enable:function(){c.addEventListener(b.start,l,!1),n.addEventListener("click",t,!1)}}})(e),r=!1;return{getValue:function(){return o.get("value")},setValue:function(e){return(e=e<E.min?E.min:e)>E.max&&(e=E.max),o.set("value",e),e},disable:function(){r||(o.disable(),r=!0)},enable:function(){r&&(o.enable(),r=!1)}}}};function a(e){var t="string"==typeof e.className?e:e.className,n="string"==typeof e.className?"className":"baseVal";return{get:function(){return t[n]},set:function(e){t[n]=e}}}function u(e){return-1!==Object.prototype.toString.call(e).indexOf("Array")}function d(e){return-1!==Object.prototype.toString.call(e).indexOf("Object")}function r(e,t){return e.style.display=t,e}function l(e){return e.currentStyle?e.currentStyle.display:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("display"):void 0}}var t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.VanillaSlider=e}(),function(){function e(){var t=kml.args.container.querySelector("#errorMessage");return{inputTypeSupport:function(e,t){var n=document.createElement("input");return n.setAttribute("type",e),n.setAttribute("value",t),n.type===e&&n.value!==t},isBrowserSupportTouchEvents:function(){var t=!0;try{document.createEvent("TouchEvent")}catch(e){t=!1}return t},colorObjToArr:function(e){return Array.isArray(e)?e:[e.r,e.g,e.b,e.a]},rgbToHex:function(e,t,n){return"object"===_typeof(e)?kml.rgbToHex.apply(this,[e.r,e.g,e.b]):"#"+[e,t,n].map(function(e){e=(e||0).toString(16);return e.length<2?"0"+e:e}).join("")},hexToRGBArray:function(e){var t=this.normalizeHexColor(e),e=function(e){return parseInt(t.slice(e,e+2),16)};return[e(0),e(2),e(4)]},normalizeHexColor:function(e){return e.replace("#","").replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3")},showError:function(e){t.textContent=e,t.style.display=""},hideError:function(){"none"!==t.style.display&&(t.style.display="none")},getSelectValues:function(e){for(var t,n=[],o=e&&e.options,r=0,l=o.length;r<l;r++)(t=o[r]).selected&&n.push({value:t.value});return n},decodeHTMLEntities:function(e){var t=document.createElement("a");return e&&"string"==typeof e&&(e=e.replace(/&amp;nbsp;/g,"")),t.innerHTML=e,t.textContent}}}var t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Utils=e}(),function(){function e(){function e(){var e,t,n,o,r;i=kml.args.container.querySelector("#colorPicker").querySelectorAll(".quickColorsBox"),s=kml.utils.colorObjToArr(l),e=kml.args.container.querySelector("#colorPicker"),n=e.getElementsByClassName("transparencySlider")[0],o=e.getElementsByClassName("transparencyButtonSet")[0],r=e.getElementsByClassName("transparencySliderValue")[0],e=e.getElementsByClassName("transparencySliderControl")[0],t=kml.vanillaSlider.slider(e,{min:0,max:100,step:5,value:r.textContent=(r=s[3],Math.round(100-100*(r<=1?r:r/255)))}),r={get:function(){return t?Math.round((100-t.getValue())/100*255):0},set:function(e){t.setValue(e.a||e[3]||0)}},n=n,(o=o).parentNode.removeChild(o),n.style.display="block",a=r}var i=null,a=null,s=null,c=[255,69,0,38],l={r:255,g:69,b:0,a:38},o=null;return{getDefaultColor:function(){return c},getDefaultColorHex:function(){return"#FF4500"},getTransparencyControl:function(){return a},getDefaultTransparencyValue:function(){return 85},getPicker:function(){return o},setVariables:e,formColorPicker:function(){e();function r(){return kml.args.container.querySelector("#colorPicker INPUT:not([type='radio'])")}function l(t){n.forEach(function(e){"change"===e.eventType&&e.callback(t)})}var n=[];return(o=(kml.utils.inputTypeSupport("color","hello world")?function(){var n=r();return n.type="color",n.addEventListener("change",function(){l(t.value)},!1),{setValue:function(e){var t=kml.utils.rgbToHex.apply(kml,kml.utils.colorObjToArr(e));n.value=t,n.style.opacity=kml.utils.colorObjToArr(e)[3]/255,l(t)},getValue:function(){return kml.utils.hexToRGBArray(n.value)},getHexValue:function(){return n.value}}}:function(){var e=r(),o=new jscolor(e);return o.valueElement.addEventListener("change",function(){l("#"+t.value)},!1),{setValue:function(e){var t=3<e.length?e.slice(0,3):e,n=3<e.length?e.slice(3,4):255*kml.utils.colorObjToArr(c)[3],e=kml.utils.rgbToHex.apply(kml.utils,kml.utils.colorObjToArr(t));o.fromRGB.apply(o,function(e){var e="string"==typeof e?kml.utils.hexToRGBArray(e):e,t=kml.utils.colorObjToArr(e);for(1<Math.max.apply(Math,t)&&(t=t.map(function(e){return void 0===e?1:e/255}));t.length<4;)t.push(0);return t.slice()}(t)),r().style.opacity=n/255,r().style.backgroundColor=e,l(e)},getValue:function(){return(o.rgb||c).map(function(e){return 255*e})},getHexValue:function(){return e.value},originalPicker:o}})()).setValue(s),["#ff4500","#ffa500","#008000","#ffff00","#ADD8E6","#0000ff","#800080"].forEach(function(e){var t=document.createElement("div");t.className="quickColor",t.setAttribute("ng-click","setQuickColor($event)"),t.style.backgroundColor=e,i[0].appendChild(t)}),{value:function(e){return e?(o.setValue(e),a.set(e),e):{r:(e=o.getValue())[0],g:e[1],b:e[2],a:a.get()}},attachEvent:function(e,t){n.push({eventType:e,callback:t})}}},setQuickColor:function(e){var t;e.target.style.backgroundColor&&(e=(t=e.target.style.backgroundColor).indexOf("#")<0?/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g.exec(t).splice(1):kml.utils.hexToRGBArray(t),(t=[]).push(parseInt(e[0],10)),t.push(parseInt(e[1],10)),t.push(parseInt(e[2],10)),t.push(a.get()),o.setValue(t),kml.args.container.querySelector("#colorPickerField").value=o.getHexValue())},setDefaultColor:function(){o.setValue(c)}}}var t=this,n=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):n.ColorPicker=e}(),function(){function e(){var t=null,n=null;return{init:function(){t=kml.args.container.getElementsByClassName("dragAndDropUploader")[0],n=t.className;var e=t.getElementsByTagName("input")[0];t.ondragover=function(){return angular.injector(["ng","importKMLZones"]).get("clearService").clear(),t.className=n+" hoverArea",!1},t.ondragleave=function(){return t.className=n,!1},t.ondrop=function(e){e.preventDefault(),t.className=n;e=e.dataTransfer.files;kml.parseFiles(e)},t.onclick=function(){e.click()}},clear:function(){t.className=n}}}var t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Uploader=e}(),function(){function e(){var e=kml.args.container.querySelector("#waiting"),t=e,n=new Spinner({lines:13,length:24,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}),o=kml.args.container.querySelector("#progressContainer"),r=kml.args.container.querySelector("#importProgress");return{show:function(){e.style.display="",n.spin(t)},hide:function(){e.style.display="none",n.stop()},showProgressBar:function(){o.style.display="",kml.args.container.style.overflow="hidden",kml.args.container.style.height="100%",r.value="0"},hideProgressBar:function(){setTimeout(function(){o&&(o.style.display="none",kml.args.container.style.overflow="",kml.args.container.style.height="auto")},400)},updateProgressBar:function(e){r&&(r.value+=e)}}}var t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Waiting=e}();