{"version":3,"sources":["engineDataButton.js"],"names":["geotab","customButtons","engineDataButton","event","api","state","noVehiclesText","mutipleVehiclesText","preventDefault","diagnostics","device","pageState","getState","id","length","isMultipleDevices","Array","isArray","dateRange","date","Date","interval","endDate","getTime","startDate","toISOString","messenger","timer","mainContainer","textContainer","closeIcon","addAttributes","element","attrs","a","hasOwnProperty","setAttribute","addCss","styles","style","createElement","elemName","css","appendTo","elem","document","appendChild","destroy","clearInterval","undefined","removeEventListener","parentNode","removeChild","getMainContent","querySelector","createMainContent","body","innerHTML","addEventListener","showMessage","warningText","setInterval","textContent","gotoPage","diagnostic"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,MAAM,CAACC,aAAP,CAAqBC,gBAArB,GAAwC,UAACC,KAAD,EAAQC,GAAR,EAAaC,KAAb,EAAuB;AAC7D;;AAEA,MAAMC,cAAc,GAAG,0BAAvB;AACA,MAAMC,mBAAmB,GAAG,6CAA5B;AAEAJ,EAAAA,KAAK,CAACK,cAAN,GAN6D,CAQ7D;;AACA,MAAIC,WAAW,GAAG,CAChB,yBADgB,EAEhB,6BAFgB,EAGhB,6BAHgB,CAAlB,CAT6D,CAe7D;;AACA,MAAIC,MAAM,GAAI,YAAM;AAClB,QAAIC,SAAS,GAAGN,KAAK,CAACO,QAAN,EAAhB;AACA,WAAQD,SAAS,IAAIA,SAAS,CAACE,EAAvB,IAA6BF,SAAS,CAACE,EAAV,CAAaC,MAA3C,GAAqDH,SAAS,CAACE,EAA/D,GAAoE,IAA3E;AACD,GAHY,EAAb;;AAKA,MAAIE,iBAAiB,GAAGL,MAAM,KAAK,IAAX,IAAmBM,KAAK,CAACC,OAAN,CAAcP,MAAd,CAA3C,CArB6D,CAuB7D;;AACA,MAAIQ,SAAS,GAAI,YAAM;AACrB,QAAIC,IAAI,GAAG,IAAIC,IAAJ,EAAX;AAAA,QACEC,QAAQ,GAAG,KAAK,EAAL,GAAU,EAAV,GAAe,IAD5B;AAAA,QACoC;AAClCC,IAAAA,OAAO,GAAG,IAAIF,IAAJ,CAASD,IAAI,CAACI,OAAL,KAAiBF,QAA1B,CAFZ;AAGA,WAAO;AACLG,MAAAA,SAAS,EAAEF,OAAO,CAACG,WAAR,EADN;AAELH,MAAAA,OAAO,EAAEH,IAAI,CAACM,WAAL;AAFJ,KAAP;AAID,GARe,EAAhB,CAxB6D,CAkC7D;;;AACA,MAAIC,SAAS,GAAI,YAAM;AAErB,QAAIC,KAAJ;AACA,QAAIC,aAAJ;AACA,QAAIC,aAAJ;AACA,QAAIC,SAAJ;;AAEA,QAAIC,aAAa,GAAG,SAAhBA,aAAgB,CAAUC,OAAV,EAAmBC,KAAnB,EAA0B;AAC5C,WAAK,IAAIC,CAAT,IAAcD,KAAd,EAAqB;AACnB,YAAIA,KAAK,CAACE,cAAN,CAAqBD,CAArB,CAAJ,EAA6B;AAC3BF,UAAAA,OAAO,CAACI,YAAR,CAAqBF,CAArB,EAAwBD,KAAK,CAACC,CAAD,CAA7B;AACD;AACF;AACF,KAND;;AAQA,QAAIG,MAAM,GAAG,SAATA,MAAS,CAAUL,OAAV,EAAmBM,MAAnB,EAA2B;AACtC,WAAK,IAAIJ,CAAT,IAAcI,MAAd,EAAsB;AACpB,YAAIA,MAAM,CAACH,cAAP,CAAsBD,CAAtB,CAAJ,EAA8B;AAC5BF,UAAAA,OAAO,CAACO,KAAR,CAAcL,CAAd,IAAmBI,MAAM,CAACJ,CAAD,CAAzB;AACD;AACF;AACF,KAND;;AAQA,QAAIM,aAAa,GAAG,SAAhBA,aAAgB,CAAUC,QAAV,EAAoBR,KAApB,EAA2BS,GAA3B,EAAgCC,QAAhC,EAA0C;AAC5D,UAAIC,IAAI,GAAGC,QAAQ,CAACL,aAAT,CAAuBC,QAAvB,CAAX;;AAEA,UAAIR,KAAJ,EAAW;AACTF,QAAAA,aAAa,CAACa,IAAD,EAAOX,KAAP,CAAb;AACD;;AAED,UAAIS,GAAJ,EAAS;AACPL,QAAAA,MAAM,CAACO,IAAD,EAAOF,GAAP,CAAN;AACD;;AAED,UAAIC,QAAJ,EAAc;AACZA,QAAAA,QAAQ,CAACG,WAAT,CAAqBF,IAArB;AACD;;AAED,aAAOA,IAAP;AACD,KAhBD;;AAkBA,QAAIG,OAAO,GAAG,SAAVA,OAAU,GAAM;AAClB,UAAIpB,KAAJ,EAAW;AACTqB,QAAAA,aAAa,CAACrB,KAAD,CAAb;AACAA,QAAAA,KAAK,GAAGsB,SAAR;AACD;;AAED,UAAInB,SAAJ,EAAe;AACbA,QAAAA,SAAS,CAACoB,mBAAV,CAA8B,OAA9B,EAAuCH,OAAvC,EAAgD,KAAhD;AACD;;AAED,UAAInB,aAAa,IAAIA,aAAa,CAACuB,UAAnC,EAA+C;AAC7CvB,QAAAA,aAAa,CAACuB,UAAd,CAAyBC,WAAzB,CAAqCxB,aAArC;AACD;;AAEDA,MAAAA,aAAa,GAAGqB,SAAhB;AACApB,MAAAA,aAAa,GAAGoB,SAAhB;AACAnB,MAAAA,SAAS,GAAGmB,SAAZ;AACD,KAjBD;;AAmBA,QAAII,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AACzB,aAAOR,QAAQ,CAACS,aAAT,CAAuB,yBAAvB,CAAP;AACD,KAFD;;AAIA,QAAIC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC5B3B,MAAAA,aAAa,GAAGY,aAAa,CAAC,KAAD,EAAQ;AACnC3B,QAAAA,EAAE,EAAE;AAD+B,OAAR,EAE1B;AACC,kBAAU,mBADX;AAEC,4BAAoB,SAFrB;AAGC,iBAAS,MAHV;AAIC,kBAAU,eAJX;AAKC,oBAAY,UALb;AAMC,iBAAS,OANV;AAOC,eAAO,CAPR;AAQC,iBAAS,GARV;AASC,mBAAW,OATZ;AAUC,wBAAgB,OAVjB;AAWC,mBAAW,GAXZ;AAYC,sBAAc;AAZf,OAF0B,EAexBgC,QAAQ,CAACW,IAfe,CAA7B;AAiBA5B,MAAAA,aAAa,CAACmB,OAAd,GAAwBA,OAAxB;AAEAlB,MAAAA,aAAa,GAAGW,aAAa,CAAC,IAAD,EAAO,IAAP,EAAa;AACxC,mBAAW,cAD6B;AAExC,kBAAU,OAF8B;AAGxC,qBAAa,YAH2B;AAIxC,uBAAe,QAJyB;AAKxC,qBAAa,OAL2B;AAMxC,iBAAS,MAN+B;AAOxC,sBAAc;AAP0B,OAAb,EAQ1BZ,aAR0B,CAA7B;AAUAE,MAAAA,SAAS,GAAGU,aAAa,CAAC,MAAD,EAAS,IAAT,EAAe;AACtC,iBAAS,OAD6B;AAEtC,sBAAc,KAFwB;AAGtC,qBAAa,MAHyB;AAItC,iBAAS,MAJ6B;AAKtC,oBAAY,UAL0B;AAMtC,eAAO,QAN+B;AAOtC,gBAAQ,QAP8B;AAQtC,uBAAe,OARuB;AAStC,sBAAc,QATwB;AAUtC,uBAAe,MAVuB;AAWtC,kBAAU,SAX4B;AAYtC,mBAAW,cAZ2B;AAatC,2BAAmB,MAbmB;AActC,sBAAc,QAdwB;AAetC,0BAAkB,QAfoB;AAgBtC,oBAAY,QAhB0B;AAiBtC,wBAAgB,QAjBsB;AAkBtC,0BAAkB,MAlBoB;AAmBtC,iBAAS;AAnB6B,OAAf,EAoBtBZ,aApBsB,CAAzB;AAsBAE,MAAAA,SAAS,CAAC2B,SAAV,GAAsB,GAAtB;AACA3B,MAAAA,SAAS,CAAC4B,gBAAV,CAA2B,OAA3B,EAAoCX,OAApC,EAA6C,KAA7C;AACD,KAtDD;;AAwDA,WAAO;AACL;AACN;AACA;AACMY,MAAAA,WAAW,EAAE,qBAACC,WAAD,EAAiB;AAC5BhC,QAAAA,aAAa,GAAGyB,cAAc,EAA9B;;AACA,YAAI,CAACzB,aAAL,EAAoB;AAClB2B,UAAAA,iBAAiB;AACjB5B,UAAAA,KAAK,GAAGkC,WAAW,CAACd,OAAD,EAAU,IAAV,CAAnB;AACD;;AACDlB,QAAAA,aAAa,CAACiC,WAAd,GAA4BF,WAA5B;AACD,OAXI;;AAYL;AACN;AACA;AACMb,MAAAA,OAAO,EAAE,mBAAM;AACbnB,QAAAA,aAAa,GAAGA,aAAa,IAAIyB,cAAc,EAA/C;;AACA,YAAIzB,aAAJ,EAAmB;AACjBA,UAAAA,aAAa,CAACmB,OAAd;AACD;AACF;AApBI,KAAP;AAsBD,GA9Ie,EAAhB;;AAgJA,MAAIrC,MAAM,IAAIA,MAAM,KAAK,KAArB,IAA8B,CAACK,iBAAnC,EAAsD;AACpDW,IAAAA,SAAS,CAACqB,OAAV,GADoD,CAGpD;;AACA1C,IAAAA,KAAK,CAAC0D,QAAN,CAAe,mBAAf,EAAoC;AAClC7C,MAAAA,SAAS,EAAEA,SADuB;AAElCR,MAAAA,MAAM,EAAE,CAACA,MAAD,CAF0B;AAGlCsD,MAAAA,UAAU,EAAEvD;AAHsB,KAApC;AAKD,GATD,MASO;AACLiB,IAAAA,SAAS,CAACiC,WAAV,CAAsB5C,iBAAiB,GAAGR,mBAAH,GAAyBD,cAAhE;AACD;AACF,CA/LD","sourcesContent":["/**\n * The function is called whenever the Add-In button is clicked.\n *\n * @param {object} event - The event dispatched from the button click.\n * @param {object} api - The GeotabApi object for making calls to MyGeotab.\n * @param {object} state - The page state object allows access to URL, page navigation and global group filter.\n */\ngeotab.customButtons.engineDataButton = (event, api, state) => {\n  'use strict';\n\n  const noVehiclesText = 'Select any vehicle first';\n  const mutipleVehiclesText = 'Graph cannot be opened for multiple devices';\n\n  event.preventDefault();\n\n  // The diagnostic ids to display the data of\n  let diagnostics = [\n    'DiagnosticEngineSpeedId',\n    'DiagnosticGoDeviceVoltageId',\n    'DiagnosticDeviceTotalFuelId'\n  ];\n\n  // The currently selected device from state\n  let device = (() => {\n    let pageState = state.getState();\n    return (pageState && pageState.id && pageState.id.length) ? pageState.id : null;\n  })();\n\n  let isMultipleDevices = device !== null && Array.isArray(device);\n\n  // The date range which will be used on engine data profile\n  let dateRange = (() => {\n    let date = new Date(),\n      interval = 60 * 60 * 24 * 1000,   // a day\n      endDate = new Date(date.getTime() - interval);\n    return {\n      startDate: endDate.toISOString(),\n      endDate: date.toISOString()\n    };\n  })();\n\n  // Displays messages to the UI\n  let messenger = (() => {\n\n    let timer;\n    let mainContainer;\n    let textContainer;\n    let closeIcon;\n\n    let addAttributes = function (element, attrs) {\n      for (let a in attrs) {\n        if (attrs.hasOwnProperty(a)) {\n          element.setAttribute(a, attrs[a]);\n        }\n      }\n    };\n\n    let addCss = function (element, styles) {\n      for (let a in styles) {\n        if (styles.hasOwnProperty(a)) {\n          element.style[a] = styles[a];\n        }\n      }\n    };\n\n    let createElement = function (elemName, attrs, css, appendTo) {\n      let elem = document.createElement(elemName);\n\n      if (attrs) {\n        addAttributes(elem, attrs);\n      }\n\n      if (css) {\n        addCss(elem, css);\n      }\n\n      if (appendTo) {\n        appendTo.appendChild(elem);\n      }\n\n      return elem;\n    };\n\n    let destroy = () => {\n      if (timer) {\n        clearInterval(timer);\n        timer = undefined;\n      }\n\n      if (closeIcon) {\n        closeIcon.removeEventListener('click', destroy, false);\n      }\n\n      if (mainContainer && mainContainer.parentNode) {\n        mainContainer.parentNode.removeChild(mainContainer);\n      }\n\n      mainContainer = undefined;\n      textContainer = undefined;\n      closeIcon = undefined;\n    };\n\n    let getMainContent = () => {\n      return document.querySelector('#engineDataButton-addin');\n    };\n\n    let createMainContent = () => {\n      mainContainer = createElement('div', {\n        id: 'engineDataButton-addin'\n      }, {\n          'border': '1px solid #ffeb94',\n          'background-color': '#fffcdd',\n          'color': '#222',\n          'margin': '0 auto 0 auto',\n          'position': 'relative',\n          'width': '600px',\n          'top': 0,\n          'right': '0',\n          'z-index': '10004',\n          'table-layout': 'fixed',\n          'opacity': 0.9,\n          'text-align': 'center'\n        }, document.body);\n\n      mainContainer.destroy = destroy;\n\n      textContainer = createElement('h2', null, {\n        'display': 'inline-block',\n        'margin': '5px 0',\n        'word-wrap': 'break-word',\n        'font-weight': 'normal',\n        'font-size': '1.5em',\n        'color': '#222',\n        'text-align': 'center'\n      }, mainContainer);\n\n      closeIcon = createElement('span', null, {\n        'float': 'right',\n        'margin-top': '9px',\n        'font-size': '20px',\n        'width': '30px',\n        'position': 'relative',\n        'top': '-0.1em',\n        'left': '-0.1em',\n        'font-family': 'arial',\n        'font-style': 'normal',\n        'font-weight': 'bold',\n        'cursor': 'pointer',\n        'display': 'inline-block',\n        'text-decoration': 'none',\n        'text-align': 'center',\n        'vertical-align': 'middle',\n        'overflow': 'hidden',\n        'font-variant': 'normal',\n        'text-transform': 'none',\n        'color': '#222'\n      }, mainContainer);\n\n      closeIcon.innerHTML = 'x';\n      closeIcon.addEventListener('click', destroy, false);\n    };\n\n    return {\n      /**\n       * Shows a message to the UI\n       */\n      showMessage: (warningText) => {\n        mainContainer = getMainContent();\n        if (!mainContainer) {\n          createMainContent();\n          timer = setInterval(destroy, 5000);\n        }\n        textContainer.textContent = warningText;\n      },\n      /**\n       * Destorys the current message\n       */\n      destroy: () => {\n        mainContainer = mainContainer || getMainContent();\n        if (mainContainer) {\n          mainContainer.destroy();\n        }\n      }\n    };\n  })();\n\n  if (device && device !== 'all' && !isMultipleDevices) {\n    messenger.destroy();\n\n    // redirect to the engine data profile page passing in arguments for device, date range and diagnostics to display\n    state.gotoPage('engineDataProfile', {\n      dateRange: dateRange,\n      device: [device],\n      diagnostic: diagnostics\n    });\n  } else {\n    messenger.showMessage(isMultipleDevices ? mutipleVehiclesText : noVehiclesText);\n  }\n};\n"],"file":"engineDataButton.js"}